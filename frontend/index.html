<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USSSA Event Central</title>
  <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700;800;900&family=Barlow+Condensed:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: linear-gradient(180deg, #050d1a, #0a1225 20%, #0d1630); color: #e2e8f0; font-family: 'Barlow', sans-serif; min-height: 100vh; }
    ::-webkit-scrollbar { height: 4px; width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 4px; }

    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.3} }
    @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }

    .fc { font-family: 'Barlow Condensed', sans-serif; }

    /* Header */
    .header { background: linear-gradient(135deg, #002147, #001a3a, #000d20); border-bottom: 1px solid rgba(255,255,255,0.06); padding: 0 20px; position: sticky; top: 0; z-index: 100; }
    .header-inner { max-width: 1200px; margin: 0 auto; }
    .header-top { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.04); }
    .logo-area { display: flex; align-items: center; gap: 12px; }
    .usssa-badge { background: linear-gradient(135deg, #cc0000, #990000); border-radius: 6px; padding: 4px 10px; font-size: 11px; font-weight: 900; color: #fff; letter-spacing: 2px; text-transform: uppercase; }
    .ec-title { font-size: 16px; font-weight: 800; color: #fff; text-transform: uppercase; letter-spacing: 1px; }
    .live-badge { display: flex; align-items: center; font-size: 11px; color: #ef4444; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; }
    .live-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #ef4444; margin-right: 6px; animation: pulse 1.5s ease-in-out infinite; }
    .clock { font-size: 11px; color: #64748b; }
    .event-info { padding: 14px 0 10px; }
    .event-name { font-size: 20px; font-weight: 900; color: #fff; text-transform: uppercase; letter-spacing: 0.5px; }
    .event-meta { font-size: 12px; color: #64748b; margin-top: 2px; }

    /* Tabs */
    .tabs { display: flex; gap: 0; overflow-x: auto; }
    .tab { background: none; border: none; cursor: pointer; padding: 10px 16px; color: #64748b; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; white-space: nowrap; border-bottom: 2px solid transparent; transition: all 0.2s; }
    .tab.active { color: #f59e0b; border-bottom-color: #f59e0b; }

    /* Content */
    .content { max-width: 1200px; margin: 0 auto; padding: 20px 20px 60px; }

    /* Age filters */
    .age-filters { display: flex; gap: 6px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 4px; }
    .age-btn { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); border-radius: 20px; padding: 6px 14px; cursor: pointer; color: #94a3b8; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; white-space: nowrap; transition: all 0.2s; }
    .age-btn.active { background: linear-gradient(135deg, #cc0000, #990000); border: none; color: #fff; }

    /* Game cards */
    .games-list { display: flex; flex-direction: column; gap: 12px; }
    .game-card { background: #0d1b33; border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; overflow: hidden; transition: border-color 0.3s; }
    .game-card.live { background: linear-gradient(135deg, #0a1628, #1a2744); border-color: rgba(239,68,68,0.3); }
    .game-card .shimmer-bar { height: 2px; background: linear-gradient(90deg, #ef4444, #f59e0b, #ef4444); background-size: 200% 100%; animation: shimmer 2s linear infinite; }
    .game-header { padding: 14px 16px; cursor: pointer; }
    .game-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .game-meta { font-size: 10px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1.5px; }
    .game-status { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; display: flex; align-items: center; gap: 4px; }
    .game-status.live { color: #ef4444; }
    .game-status.final { color: #64748b; }
    .game-status.upcoming { color: #f59e0b; }
    .team-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
    .team-name { color: #e2e8f0; font-size: 14px; font-weight: 500; flex: 1; }
    .team-score { font-size: 22px; font-weight: 800; min-width: 30px; text-align: right; }
    .team-score.winning { color: #fff; }
    .team-score.losing { color: #94a3b8; }
    .expand-hint { font-size: 10px; color: #334155; text-transform: uppercase; letter-spacing: 1.5px; margin-top: 8px; text-align: center; }
    .expand-arrow { font-size: 10px; color: #475569; transition: transform 0.3s; display: inline-block; }
    .expand-arrow.open { transform: rotate(180deg); }

    /* Box score dropdown */
    .box-score-panel { border-top: 1px solid rgba(255,255,255,0.06); padding: 16px; background: rgba(0,0,0,0.2); animation: fadeIn 0.3s ease; display: none; }
    .box-score-panel.open { display: block; }
    .box-team-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; padding: 0 4px; }
    .box-team-name { font-size: 12px; font-weight: 800; color: #f59e0b; text-transform: uppercase; letter-spacing: 2px; }
    .box-team-score { font-size: 18px; font-weight: 900; color: #fff; }
    .box-divider { height: 1px; background: rgba(255,255,255,0.06); margin: 16px 0; }

    /* Stats tables */
    .stats-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 4px; }
    .stats-table th { padding: 4px 5px; font-size: 9px; color: #475569; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; border-bottom: 1px solid rgba(255,255,255,0.06); }
    .stats-table th:first-child { text-align: left; }
    .stats-table th:not(:first-child) { text-align: center; }
    .stats-table td { padding: 3px 5px; font-size: 13px; }
    .stats-table td:first-child { color: #cbd5e1; white-space: nowrap; }
    .stats-table td:not(:first-child) { text-align: center; color: #94a3b8; }
    .stats-table .player-jersey { color: #3d4f63; font-size: 10px; margin-right: 4px; }
    .stats-table .player-pos { color: #334155; font-size: 10px; margin-left: 4px; }
    .stats-table .totals td { border-top: 1px solid rgba(255,255,255,0.08); color: #e2e8f0; font-weight: 700; }
    .stat-r { color: #22c55e !important; font-weight: 600; }
    .stat-h { color: #f59e0b !important; font-weight: 600; }
    .stat-rbi { color: #38bdf8 !important; font-weight: 600; }
    .stat-so { color: #ef4444 !important; font-weight: 600; }
    .stat-k { color: #f59e0b !important; font-weight: 600; }
    .stat-zero { color: #3d4f63 !important; font-weight: 400; }

    /* Line score */
    .line-score { overflow-x: auto; margin-bottom: 16px; }
    .line-score table { width: 100%; border-collapse: collapse; font-size: 12px; }
    .line-score th { padding: 4px 6px; text-align: center; color: #475569; font-size: 10px; font-weight: 700; border-bottom: 1px solid rgba(255,255,255,0.06); min-width: 24px; }
    .line-score th:first-child { text-align: left; }
    .line-score .rhe { color: #f59e0b; font-weight: 800; border-left: 1px solid rgba(255,255,255,0.08); }
    .line-score td { padding: 4px 6px; text-align: center; font-size: 13px; }
    .line-score td:first-child { text-align: left; color: #cbd5e1; font-weight: 600; white-space: nowrap; max-width: 120px; overflow: hidden; text-overflow: ellipsis; }
    .line-score .total { font-weight: 800; color: #fff; border-left: 1px solid rgba(255,255,255,0.08); }
    .line-score .inn-score { font-weight: 700; }
    .line-score .inn-zero { color: #3d4f63; }

    /* Leaderboard */
    .lb-toggle { display: flex; gap: 0; margin-bottom: 20px; background: rgba(255,255,255,0.03); border-radius: 8px; overflow: hidden; width: fit-content; }
    .lb-btn { background: transparent; border: none; cursor: pointer; padding: 8px 20px; color: #64748b; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; transition: all 0.2s; }
    .lb-btn.active { background: linear-gradient(135deg, #cc0000, #990000); color: #fff; }
    .lb-panel { background: #0a1225; border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; overflow: hidden; }
    .lb-table { width: 100%; border-collapse: collapse; }
    .lb-table th { padding: 10px 6px; font-size: 10px; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; border-bottom: 1px solid rgba(255,255,255,0.06); position: sticky; top: 0; background: #0a1225; }
    .lb-table th:first-child, .lb-table th:nth-child(2) { text-align: left; }
    .lb-table th:not(:first-child):not(:nth-child(2)) { text-align: center; }
    .lb-table td { padding: 10px 6px; border-bottom: 1px solid rgba(255,255,255,0.03); white-space: nowrap; }
    .lb-table td:first-child { font-weight: 800; }
    .lb-table td:first-child, .lb-table td:nth-child(2) { text-align: left; }
    .lb-table td:not(:first-child):not(:nth-child(2)) { text-align: center; color: #94a3b8; }
    .lb-table tr:hover { background: rgba(255,255,255,0.03); }
    .lb-rank-gold { color: #f59e0b; }
    .lb-rank-gray { color: #475569; }
    .lb-player-name { font-weight: 600; color: #e2e8f0; font-size: 13px; }
    .lb-player-team { font-size: 10px; color: #64748b; }
    .lb-highlight { color: #f59e0b !important; font-weight: 800 !important; font-size: 16px !important; }

    /* POTG */
    .potg-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }
    .potg-card { background: linear-gradient(145deg, #0a1628, #162040, #1a1040); border-radius: 16px; padding: 24px; position: relative; overflow: hidden; }
    .potg-card .glow { position: absolute; border-radius: 50%; }
    .potg-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 4px; }
    .potg-name { font-size: 22px; font-weight: 800; color: #fff; text-transform: uppercase; line-height: 1.1; }
    .potg-info { font-size: 12px; color: #94a3b8; margin-top: 2px; }
    .potg-score-circle { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 800; }
    .potg-highlights { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 10px 14px; margin-bottom: 12px; font-size: 15px; color: #f8fafc; font-weight: 600; }
    .potg-game { font-size: 11px; color: #64748b; }

    /* Standings */
    .standings-panel { background: #0a1225; border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; overflow: hidden; }
    .standings-table { width: 100%; border-collapse: collapse; }
    .standings-table th { padding: 10px 8px; font-size: 10px; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; border-bottom: 1px solid rgba(255,255,255,0.06); }
    .standings-table th:first-child, .standings-table th:nth-child(2) { text-align: left; }
    .standings-table th:not(:first-child):not(:nth-child(2)) { text-align: center; }
    .standings-table td { padding: 10px 8px; font-size: 13px; }
    .standings-table td:first-child, .standings-table td:nth-child(2) { text-align: left; }
    .standings-table td:not(:first-child):not(:nth-child(2)) { text-align: center; }
    .standings-table tr:hover { background: rgba(255,255,255,0.03); }
    .w-col { color: #22c55e; font-weight: 700; font-size: 14px; }
    .l-col { color: #ef4444; font-weight: 700; font-size: 14px; }
    .diff-pos { color: #22c55e; font-weight: 700; }
    .diff-neg { color: #ef4444; font-weight: 700; }

    /* All-Tournament placeholder */
    .at-placeholder { margin-top: 40px; background: rgba(255,255,255,0.02); border: 1px dashed rgba(255,255,255,0.08); border-radius: 16px; padding: 40px; text-align: center; }

    /* Loading */
    .loading { text-align: center; padding: 60px; color: #475569; }

    /* Section label */
    .section-label { font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 16px; }

    /* Footer */
    .footer { border-top: 1px solid rgba(255,255,255,0.04); padding: 16px 20px; text-align: center; font-size: 10px; color: #334155; text-transform: uppercase; letter-spacing: 2px; }

    /* Empty state */
    .empty { text-align: center; padding: 60px; color: #475569; }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="header-inner">
      <div class="header-top">
        <div class="logo-area">
          <span class="usssa-badge fc">USSSA</span>
          <span class="ec-title fc">EVENT CENTRAL</span>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <div id="liveCount" class="live-badge fc" style="display:none;"><span class="live-dot"></span><span id="liveNum"></span> LIVE</div>
          <div id="clock" class="clock fc"></div>
        </div>
      </div>
      <div class="event-info">
        <div class="event-name fc">USSSA FL Event Central</div>
        <div class="event-meta">Live Stats • Leaderboards • Player of the Game</div>
      </div>
      <div class="tabs">
        <button class="tab fc active" data-tab="scores">Scoreboard</button>
        <button class="tab fc" data-tab="potg">Player of the Game</button>
        <button class="tab fc" data-tab="leaders">Leaderboards</button>
        <button class="tab fc" data-tab="standings">Standings</button>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="content">
    <!-- SCOREBOARD -->
    <div id="panel-scores" class="panel">
      <div id="games-list" class="games-list">
        <div class="loading">Loading games...</div>
      </div>
    </div>

    <!-- POTG -->
    <div id="panel-potg" class="panel" style="display:none;">
      <div class="section-label fc">Top Performers</div>
      <div id="potg-grid" class="potg-grid">
        <div class="loading">Loading...</div>
      </div>
      <div class="at-placeholder">
        <div style="font-size:32px;margin-bottom:8px;">⭐</div>
        <div class="fc" style="font-size:16px;font-weight:700;color:#475569;text-transform:uppercase;letter-spacing:2px;">All-Tournament Team</div>
        <div style="font-size:13px;color:#334155;margin-top:4px;">Selected after the final game</div>
      </div>
    </div>

    <!-- LEADERBOARDS -->
    <div id="panel-leaders" class="panel" style="display:none;">
      <div class="lb-toggle">
        <button class="lb-btn fc active" data-lb="batting">Batting</button>
        <button class="lb-btn fc" data-lb="pitching">Pitching</button>
      </div>
      <div class="lb-panel">
        <div id="lb-content"><div class="loading">Loading...</div></div>
      </div>
    </div>

    <!-- STANDINGS -->
    <div id="panel-standings" class="panel" style="display:none;">
      <div class="section-label fc">Standings</div>
      <div class="standings-panel">
        <div id="standings-content"><div class="loading">Loading...</div></div>
      </div>
    </div>
  </main>

  <footer class="footer fc">Powered by USSSA Event Central • Stats via GameChanger</footer>

  <script>
    // ─── CONFIG ──────────────────────────────────────────
    const API_BASE = window.location.origin; // same server
    let currentTab = 'scores';
    let currentLB = 'batting';
    let expandedGame = null;
    let gamesData = [];
    let leaderData = {};

    // ─── CLOCK ───────────────────────────────────────────
    function updateClock() {
      document.getElementById('clock').textContent = new Date().toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
    }
    updateClock();
    setInterval(updateClock, 30000);

    // ─── TABS ────────────────────────────────────────────
    document.querySelectorAll('.tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        currentTab = btn.dataset.tab;
        document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
        document.getElementById('panel-' + currentTab).style.display = 'block';
      });
    });

    // ─── LB TOGGLE ───────────────────────────────────────
    document.querySelectorAll('.lb-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.lb-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentLB = btn.dataset.lb;
        renderLeaderboard();
      });
    });

    // ─── HELPERS ─────────────────────────────────────────
    function sc(val, cls) {
      if (!val || val === 0) return `<td class="fc stat-zero">0</td>`;
      return `<td class="fc ${cls}">${val}</td>`;
    }

    // ─── FETCH GAMES ─────────────────────────────────────
    async function loadGames() {
      try {
        const res = await fetch(API_BASE + '/api/ec/games');
        const data = await res.json();
        gamesData = data.games || [];
        renderGames();
      } catch (err) {
        document.getElementById('games-list').innerHTML = '<div class="empty">Failed to load games</div>';
        console.error('Load games error:', err);
      }
    }

    function renderGames() {
      const container = document.getElementById('games-list');
      const liveCount = gamesData.filter(g => g.status === 'live').length;

      if (liveCount > 0) {
        document.getElementById('liveCount').style.display = 'flex';
        document.getElementById('liveNum').textContent = liveCount;
      }

      if (gamesData.length === 0) {
        container.innerHTML = '<div class="empty">No games yet</div>';
        return;
      }

      container.innerHTML = gamesData.map(g => {
        const isLive = g.status === 'live';
        const isFinal = g.status === 'final';
        const isExpanded = expandedGame === g.id;
        const awayWinning = (g.away_score || 0) > (g.home_score || 0);
        const homeWinning = (g.home_score || 0) > (g.away_score || 0);

        return `
          <div class="game-card ${isLive ? 'live' : ''}" data-id="${g.id}">
            ${isLive ? '<div class="shimmer-bar"></div>' : ''}
            <div class="game-header" onclick="toggleBoxScore('${g.id}')">
              <div class="game-top">
                <span class="game-meta fc">${g.age_group || '—'} • ${g.field || 'TBD'}</span>
                <div style="display:flex;align-items:center;gap:8px;">
                  ${isLive ? `<span class="game-status live fc"><span class="live-dot"></span>LIVE</span>` : ''}
                  ${isFinal ? `<span class="game-status final fc">FINAL</span>` : ''}
                  ${!isLive && !isFinal ? `<span class="game-status upcoming fc">${g.scheduled_time || ''}</span>` : ''}
                  <span class="expand-arrow ${isExpanded ? 'open' : ''}">▼</span>
                </div>
              </div>
              <div class="team-row">
                <span class="team-name">${g.away_team}</span>
                <span class="team-score fc ${awayWinning ? 'winning' : 'losing'}">${g.away_score ?? '-'}</span>
              </div>
              <div class="team-row" style="margin-bottom:0;">
                <span class="team-name">${g.home_team}</span>
                <span class="team-score fc ${homeWinning ? 'winning' : 'losing'}">${g.home_score ?? '-'}</span>
              </div>
              ${!isExpanded ? '<div class="expand-hint fc">Tap for box score</div>' : ''}
            </div>
            <div class="box-score-panel ${isExpanded ? 'open' : ''}" id="box-${g.id}"></div>
          </div>
        `;
      }).join('');
    }

    // ─── TOGGLE BOX SCORE ────────────────────────────────
    async function toggleBoxScore(gameId) {
      if (expandedGame === gameId) {
        expandedGame = null;
        renderGames();
        return;
      }

      expandedGame = gameId;
      renderGames();

      const panel = document.getElementById('box-' + gameId);
      panel.innerHTML = '<div class="loading" style="padding:20px;">Loading box score...</div>';
      panel.classList.add('open');

      try {
        const res = await fetch(API_BASE + '/api/ec/games/' + gameId);
        const data = await res.json();
        const g = data.game;

        let html = '';

        // Away team box score
        html += renderTeamBox(g.away_team, g.away_score, g.boxScore.away);
        html += '<div class="box-divider"></div>';
        // Home team box score
        html += renderTeamBox(g.home_team, g.home_score, g.boxScore.home);

        panel.innerHTML = html;
      } catch (err) {
        panel.innerHTML = '<div class="empty">Failed to load box score</div>';
        console.error('Box score error:', err);
      }
    }

    function renderTeamBox(teamName, score, data) {
      let html = `
        <div class="box-team-header">
          <span class="box-team-name fc">${teamName}</span>
          <span class="box-team-score fc">${score}</span>
        </div>
      `;

      // Batting table
      if (data.batting && data.batting.length > 0) {
        const totals = data.batting.reduce((t, p) => ({
          ab: t.ab + (p.ab||0), r: t.r + (p.r||0), h: t.h + (p.h||0),
          rbi: t.rbi + (p.rbi||0), bb: t.bb + (p.bb||0), so: t.so + (p.so||0)
        }), { ab:0, r:0, h:0, rbi:0, bb:0, so:0 });

        html += `<table class="stats-table">
          <thead><tr>
            <th class="fc" style="text-align:left">BATTING</th>
            <th class="fc">AB</th><th class="fc">R</th><th class="fc">H</th>
            <th class="fc">RBI</th><th class="fc">BB</th><th class="fc">SO</th>
          </tr></thead><tbody>`;

        for (const p of data.batting) {
          html += `<tr>
            <td><span class="player-jersey fc">#${p.jersey}</span>${p.name}<span class="player-pos fc">${p.pos ? ' ' + p.pos : ''}</span></td>
            ${sc(p.ab, '')}${sc(p.r, 'stat-r')}${sc(p.h, 'stat-h')}${sc(p.rbi, 'stat-rbi')}${sc(p.bb, '')}${sc(p.so, 'stat-so')}
          </tr>`;
        }

        html += `<tr class="totals">
          <td class="fc" style="font-size:10px;letter-spacing:1px;">TEAM</td>
          <td class="fc">${totals.ab}</td><td class="fc">${totals.r}</td><td class="fc">${totals.h}</td>
          <td class="fc">${totals.rbi}</td><td class="fc">${totals.bb}</td><td class="fc">${totals.so}</td>
        </tr></tbody></table>`;
      }

      // Pitching table
      if (data.pitching && data.pitching.length > 0) {
        html += `<table class="stats-table" style="margin-top:8px;">
          <thead><tr>
            <th class="fc" style="text-align:left">PITCHING</th>
            <th class="fc">IP</th><th class="fc">H</th><th class="fc">R</th>
            <th class="fc">ER</th><th class="fc">BB</th><th class="fc">SO</th>
          </tr></thead><tbody>`;

        for (const p of data.pitching) {
          html += `<tr>
            <td><span class="player-jersey fc">#${p.jersey}</span>${p.name}</td>
            <td class="fc" style="text-align:center;">${p.ip || 0}</td>
            <td class="fc" style="text-align:center;">${p.h || 0}</td>
            ${sc(p.r, 'stat-so')}${sc(p.er, 'stat-so')}${sc(p.bb, '')}${sc(p.so, 'stat-k')}
          </tr>`;
        }

        html += '</tbody></table>';
      }

      return html;
    }

    // ─── LEADERBOARDS ────────────────────────────────────
    async function loadLeaderboards() {
      try {
        const res = await fetch(API_BASE + '/api/ec/leaderboards');
        leaderData = await res.json();
        renderLeaderboard();
      } catch (err) {
        document.getElementById('lb-content').innerHTML = '<div class="empty">Failed to load leaderboards</div>';
      }
    }

    function renderLeaderboard() {
      const container = document.getElementById('lb-content');
      const isBatting = currentLB === 'batting';
      const data = isBatting ? leaderData.battingLeaders : leaderData.pitchingLeaders;

      if (!data || data.length === 0) {
        container.innerHTML = '<div class="empty">No stats yet</div>';
        return;
      }

      const cols = isBatting
        ? [['#',''], ['Player',''], ['AVG','hl'], ['GP',''], ['AB',''], ['H',''], ['HR',''], ['RBI',''], ['R',''], ['OPS','']]
        : [['#',''], ['Player',''], ['ERA','hl'], ['GP',''], ['IP',''], ['K',''], ['BB',''], ['WHIP',''], ['W',''], ['SV','']];

      const keys = isBatting
        ? ['rank','name','avg','gp','ab','h','hr','rbi','r','ops']
        : ['rank','name','era','gp','ip','so','bb','whip','w','sv'];

      let html = `<table class="lb-table"><thead><tr>`;
      cols.forEach(([label]) => { html += `<th class="fc">${label}</th>`; });
      html += `</tr></thead><tbody>`;

      data.forEach((row, i) => {
        html += `<tr>`;
        keys.forEach((key, ci) => {
          if (ci === 0) {
            html += `<td class="fc ${i < 3 ? 'lb-rank-gold' : 'lb-rank-gray'}">${i + 1}</td>`;
          } else if (ci === 1) {
            html += `<td><div class="lb-player-name">${row.name}</div><div class="lb-player-team">#${row.jersey} • ${row.team}</div></td>`;
          } else if (cols[ci][1] === 'hl') {
            html += `<td class="fc lb-highlight">${row[key]}</td>`;
          } else {
            html += `<td>${row[key]}</td>`;
          }
        });
        html += `</tr>`;
      });

      html += `</tbody></table>`;
      container.innerHTML = html;
    }

    // ─── STANDINGS ───────────────────────────────────────
    async function loadStandings() {
      try {
        const res = await fetch(API_BASE + '/api/ec/standings');
        const data = await res.json();
        renderStandings(data.standings || []);
      } catch (err) {
        document.getElementById('standings-content').innerHTML = '<div class="empty">Failed to load standings</div>';
      }
    }

    function renderStandings(standings) {
      const container = document.getElementById('standings-content');
      if (standings.length === 0) {
        container.innerHTML = '<div class="empty">No standings yet</div>';
        return;
      }

      let html = `<table class="standings-table"><thead><tr>
        <th class="fc">#</th><th class="fc">Team</th><th class="fc">W</th><th class="fc">L</th>
        <th class="fc">RS</th><th class="fc">RA</th><th class="fc">+/-</th>
      </tr></thead><tbody>`;

      standings.forEach((t, i) => {
        const diffClass = t.diff.startsWith('+') ? 'diff-pos' : 'diff-neg';
        html += `<tr>
          <td class="fc" style="font-weight:800;color:${i < 2 ? '#f59e0b' : '#475569'}">${i + 1}</td>
          <td style="color:#e2e8f0;font-weight:600;">${t.team}</td>
          <td class="fc w-col">${t.w}</td>
          <td class="fc l-col">${t.l}</td>
          <td style="color:#94a3b8;">${t.rs}</td>
          <td style="color:#94a3b8;">${t.ra}</td>
          <td class="fc ${diffClass}">${t.diff}</td>
        </tr>`;
      });

      html += '</tbody></table>';
      container.innerHTML = html;
    }

    // ─── POTG ────────────────────────────────────────────
    async function renderPOTG() {
      const container = document.getElementById('potg-grid');
      try {
        const res = await fetch(API_BASE + '/api/ec/potg');
        const data = await res.json();
        const potg = data.potg || [];

        if (potg.length === 0) {
          container.innerHTML = '<div class="empty">No POTG data yet</div>';
          return;
        }

        const colors = ['#f59e0b', '#94a3b8', '#cd7f32'];
        container.innerHTML = potg.map((p, i) => {
          const ac = colors[i] || '#64748b';
          return `
            <div class="potg-card" style="border:1px solid ${ac}33;">
              <div class="glow" style="top:-30px;right:-30px;width:120px;height:120px;background:${ac}08;"></div>
              <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;position:relative;">
                <div>
                  <div class="potg-label fc" style="color:${ac};">${p.isLive ? '⚡ LIVE POTG' : '⭐ PLAYER OF THE GAME'}</div>
                  <div class="potg-name fc">${p.name}</div>
                  <div class="potg-info">#${p.jersey} • ${p.position || ''} • ${p.team}</div>
                </div>
                <div class="potg-score-circle fc" style="background:linear-gradient(135deg,${ac}22,${ac}44);border:2px solid ${ac}66;color:${ac};">${p.score}</div>
              </div>
              <div class="potg-highlights">${p.highlights || ''}</div>
              <div class="potg-game">${p.game}</div>
            </div>
          `;
        }).join('');
      } catch (err) {
        container.innerHTML = '<div class="empty">Failed to load POTG</div>';
      }
    }

    // ─── INIT ────────────────────────────────────────────
    async function init() {
      await Promise.all([loadGames(), loadLeaderboards(), loadStandings()]);
      renderPOTG();

      // Auto-refresh every 60 seconds
      setInterval(async () => {
        await loadGames();
        if (currentTab === 'leaders') await loadLeaderboards();
        if (currentTab === 'standings') await loadStandings();
      }, 60000);
    }

    init();
  </script>
</body>
</html>
